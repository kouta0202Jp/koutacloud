<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>緯度経度と住所を送信</title>
</head>
<body>
  <button id="sendBtn">送信</button>

  <script>
    const POST_URL = "https://script.google.com/macros/s/AKfycbzUbSnOFccxLVWsIgDkZdLw0TqDSE3ERPTzK2YqDW891X1NK3unkPP7IbRQ7vGs6bQH/exec";

    document.getElementById('sendBtn').addEventListener('click', () => {
      if (!navigator.geolocation) {
        alert("ブラウザが位置情報をサポートしていません");
        return;
      }

      navigator.geolocation.getCurrentPosition(async (pos) => {
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;
        const time = new Date(pos.timestamp).toISOString();

        try {
          // OpenStreetMapで住所取得
          const res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&accept-language=ja`);
          const data = await res.json();
          const address = data.display_name || "";

          const payload = {
            timestamp: time,
            latitude: lat,
            longitude: lon,
            address: address
          };

          const postRes = await fetch(POST_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
          });

          const result = await postRes.json();
          if (postRes.ok) {
            alert("送信成功: " + result.file);
          } else {
            alert("送信失敗: " + result.message);
          }

        } catch (e) {
          alert("送信中にエラー: " + e.message);
        }

      }, (err) => {
        alert("位置情報取得エラー: " + err.message);
      }, { enableHighAccuracy: true });
    });
  </script>
</body>
</html>
